<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class=" kkmlpoii idc0_336" lang="en"><head><script src="testdisk2_files/analytics.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app202.us.archive.org';v.server_ms=426;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="testdisk2_files/bundle-playback.js" charset="utf-8"></script>
<script type="text/javascript" src="testdisk2_files/wombat.js" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.xtralogic.com:80/testdisk_rebuild_bootsector.shtml","20131226114035","https://web.archive.org/","web","/_static/",
	      "1388058035");
</script>
<link rel="stylesheet" type="text/css" href="testdisk2_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="testdisk2_files/iconochive.css">
<!-- End Wayback Rewrite JS Include -->

<meta name="verify-v1" content="rAxtCE7pwN5FOnKK9gnE8ahCCAEvnnH3FUjRRXZ13KM="> 
<title>Remote Desktop Client for Android</title>
<meta name="Author" content="Xtralogic, Inc.">
<meta name="Description" content="Home page">
<meta name="Copyright" content="Copyright (C) 2006 Xtralogic, Inc.">
<meta name="Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="en">
<link rev="made" href="mailto:webmaster@xtralogic.com">
<meta name="viewport" content="width=device-width,user-scalable=no">
<link rel="StyleSheet" href="testdisk2_files/screen.css" type="text/css" media="screen">
<link rel="StyleSheet" href="testdisk2_files/print.css" type="text/css" media="print">
<link rel="StyleSheet" href="testdisk2_files/mobile.css" type="text/css" media="only screen and (max-device-width:480px)">
<meta property="og:site_name" content="Xtralogic, Inc.">
<meta property="fb:admins" content="100003727643986">
</head>

<body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" style="display: block; direction: ltr;" lang="en">
</div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20131226114035/http://www.xtralogic.com:80/testdisk_rebuild_bootsector.shtml</div>
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="testdisk2_files/donate.html" scrolling="no" style="width:100%; height:100%" frameborder="0">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","http://www.xtralogic.com/testdisk_rebuild_bootsector.shtml","20131226114035",1996,"/_static/",["/_static/css/banner-styles.css?v=omkqRugM","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

<!-- For non-visual or non-stylesheet-capable user agents -->
<div id="mainlink"><a href="#main">Skip to main content.</a></div>

<!-- ======== Header ======== -->

<div id="header">
  <div class="left">
    <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/"><img src="testdisk2_files/xtralogic_logo.png" alt="Xtralogic home page" width="325" height="60"></a>
  </div>

  <div class="subheader">
    <span class="hidden">Navigation:</span>
    <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/index.shtml">Home</a> |
    <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products.shtml">Products</a>
  </div>
</div>


<div id="sidebar">
 <div>
  <p class="title"><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products_vhd_utility.shtml">VHD Utility</a>
   </p><ul>
     <li><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products_vhd_utility_download.shtml">Download</a></li>
     <li><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products_vhd_utility_buy.shtml">Buy</a></li>
	 <li class="highlight"><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/support.shtml">Support</a></li>
     <li><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/vhd_utility_usage_examples.shtml">Usage Examples</a></li>
     <li><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/vhd_utility_background_info.shtml">About VHD storage capacity</a></li>
     <li><a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/extend_fs_part.shtml">Extending File System Partition</a></li>
   </ul>
  </div>
</div>

<!-- ======== Main Content ======== -->
<div id="main">

<div id="navhead">
  <hr>
  <span class="hidden">Path to this page:</span>
  <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products.shtml">Products</a> »
  <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/products_vhd_utility.shtml">VHD Utility</a> »
  <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/support.shtml">Support</a> »
  <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/testdisk_rebuild_bootsector.shtml">Rebuilding NTFS boot sector using Testdisk</a> »
</div>
    
<h2>Rebuilding NTFS boot sector using Testdisk</h2>
<p>
When disk capacity is changed and crosses one the following boundaries -
 528Mb, 1Gb, 2Gb, 4Gb, change in the disk geometry may cause the NTFS 
boot sector 
to become invalid. More detailed explanation can be found <a href="https://web.archive.org/web/20131226114035/http://www.xtralogic.com/support.shtml#faq_vhdu_disk_read_error" class="url">here</a>. 
Fortunately, it can be rebuilt using the <a href="https://web.archive.org/web/20131226114035/http://www.cgsecurity.org/wiki/TestDisk" class="url">Testdisk utility</a>. 
</p><p>
</p><h4>Step 1</h4>
<p>
Since a virtual machine can't boot from the VHD due to the invalid boot sector, temporally attach the VHD to <em>another</em> Virtual Machine as a second hard disk. 
Make sure that the "Undo Disks" option on that machine is disabled.
<br>  
Another approach is to use VHD Mount to mount the VHD as a disk on the host machine. 
VHD Mount is part of <a href="https://web.archive.org/web/20131226114035/http://www.microsoft.com/technet/virtualserver/software/default.mspx" class="url">Microsoft Virtual Server 2005 R2 SP1</a>.
If you don't want to install the complete Virtual Server modify the setup options to install only VHD Mount. 
By default VHD Mount is installed in the [Program Files]\Microsoft Virtual Server\Vhdmount directory. 
<br>
Run the following command to mount the VHD:
<br>
On Windows XP
<br>
<kbd>vhdmount /p  /f &lt;VHD File Name&gt;</kbd>
<br>
On Windows Server 2003
<br>
<kbd>vhdmount /m  /f &lt;VHD File Name&gt;</kbd>
<br>
</p>

<h4>Step 2</h4>
<p>
Download <a href="https://web.archive.org/web/20131226114035/http://www.cgsecurity.org/wiki/TestDisk" class="url">Testdisk utility</a>. Run testdisk_win.exe.
<br>
Select any option on this screen, as desired.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-1.png">
<br>
</p>

<h4>Step 3</h4>
<p>
Select the disk device corresponding to your VHD.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-2.png">
<br>
</p>

<h4>Step 4</h4>
<p>
Select <span class="menu">Intel</span>.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-3.png">
<br>
</p>

<h4>Step 5</h4>
<p>
Select <span class="menu">Advanced</span>. 
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-4.png">
<br>
</p>

<h4>Step 6</h4>
<p>
Select the boot partition, it is marked with the asterisk.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-5.png">
<br>
</p>

<h4>Step 7</h4>
<p>
On this screen TestDisk reports mismatch between the number of heads in 
NTFS BPB (NTFS) and number of heads reported by BIOS (HD). Rebuilding of
 the boot sector will correct this.
<br> 
Select <span class="menu">Rebuild BS</span>.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-6.png">
<br>
</p>

<h4>Step 8</h4>
<p>
Select <span class="menu">Write</span>.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-7.png">
<br>
</p>


<h4>Step 9</h4>
<p>
Type <kbd>Y</kbd> for yes.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-8.png">
<br>
</p>

<h4>Step 10</h4>
<p>
Quit the Testdisk utility all the way through all the previous screens.
<br> 
<img src="testdisk2_files/testdisk-rebuildbs-9.png">
<br>
</p>

<h4>Step 11</h4>
<p>
If you temporally connected the VHD to another Virtual Machine, disconnect it now.
<br>
If you used VHD Mount, un-mount the VHD using the following command:
<br>
<kbd>vhdmount /u &lt;VHD File Name&gt;</kbd>
<br>
<br>
</p>

<h6>
 
 This document was last modified 04/08/13 12:23:53 CDT
</h6><h6>
     
<br id="endmain">
</h6></div>

<!-- ======== Footer ======== -->

<div id="footer">
  <hr>
  Copyright © 2013 Xtralogic, Inc. All rights reserved.
</div>


<script src="testdisk2_files/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-824194-1";
urchinTracker();
</script>




</body></html>
<!--
     FILE ARCHIVED ON 11:40:35 Dec 26, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 04:32:42 Dec 26, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 172.185
  exclusion.robots: 0.171
  exclusion.robots.policy: 0.166
  RedisCDXSource: 1.473
  esindex: 0.008
  LoadShardBlock: 154.517 (3)
  PetaboxLoader3.datanode: 168.157 (4)
  CDXLines.iter: 13.709 (3)
  PetaboxLoader3.resolve: 149.287 (2)
  load_resource: 249.385
-->