location:
    working_directory: /mnt/borg_lvm
    source_directories:
        - "."
    read_special: false
    one_file_system: true
    exclude_caches: true
    keep_exclude_tags: true
    # TODO: numeric_ids: true

    repositories:
        !include /etc/borgmatic.d/shared/repo.yaml

    exclude_patterns:
        - pf:cdrom
        - pf:dev
        - pf:media
        - pf:mnt
        - pf:proc
        - pf:run
        - pf:swapfile
        - pf:swap.img
        - pf:sys
        - pf:tmp

        - sh:home/*/.android/build-cache
        - sh:home/*/.ansible/tmp
        - sh:home/*/.cache
        - sh:home/*/.cinnamon/spices.cache
        - sh:home/*/.config/*/*Cache*  # crappy Electron apps
        - sh:home/*/.config/chromium/*/GPUCache
        - sh:home/*/.config/chromium/*/Service Worker/CacheStorage
        - sh:home/*/.gvfs
        - sh:home/*/.ICEauthority
        - sh:home/*/.local/share/virtualenvs
        - sh:home/*/.mozilla/firefox/Crash Reports
        - sh:home/*/.mozilla/firefox/*/datareporting
        - sh:home/*/.npm/_cacache
        - sh:home/*/.nv
        - sh:home/*/.local/share/TelegramDesktop/tdata/*/*cache*
        - sh:home/*/.Xauthority
        - pf:root/.cache

        - pf:var/cache/apt
        - pf:var/lock
        - pf:var/run
        - pf:var/tmp

        - '*.pyc'
        # '*/node_modules/' not excluded, as not all of them were created with "npm install"

        - '*/.gradle/'
        # Attempt to exclude Android Studio build/ but nothing else:
        - '*/app/build/intermediates/'
        - '*/app/build/outputs/'
        - '*/app/build/kotlin/'
        - '*/app/build/tmp/'
        - '*/app/build/generated/'


storage:
    <<: !include /etc/borgmatic.d/config/linux_storage.yaml


# Just because it's mandatory:
retention:
    prefix: INVALID-

hooks:
    before_backup:
        - /etc/borgmatic.d/linux_hooks.sh before

    after_backup:
        - /etc/borgmatic.d/linux_hooks.sh after

    # TODO: on error run /etc/borgmatic.d/pata_hooks.sh cleanup
    # TODO: https://torsion.org/borgmatic/docs/how-to/monitor-your-backups/#healthchecks-hook
